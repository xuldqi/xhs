# 🧪 测试指南

## 快速开始

```bash
cd xiaohongshu-guide-generator
npm run dev
```

访问: http://localhost:5173

---

## ✅ 测试清单

### 1. 认证持久化测试

#### 测试 1.1: 刷新页面保持登录
- [ ] 访问首页并登录
- [ ] 按 F5 刷新页面
- [ ] ✅ 应该保持登录状态，不需要重新登录

#### 测试 1.2: 关闭浏览器后恢复登录
- [ ] 登录账号
- [ ] 完全关闭浏览器
- [ ] 重新打开浏览器，访问应用
- [ ] ✅ 应该自动恢复登录状态

#### 测试 1.3: 跨标签页状态同步
- [ ] 在标签页 A 登录
- [ ] 打开新标签页 B，访问应用
- [ ] ✅ 标签页 B 应该显示已登录
- [ ] 在标签页 A 登出
- [ ] ✅ 标签页 B 应该自动同步登出状态

#### 测试 1.4: Token 自动刷新
- [ ] 登录账号
- [ ] 等待 1 小时（或修改 token 过期时间）
- [ ] 执行需要认证的操作
- [ ] ✅ 应该自动刷新 token，无需重新登录

---

### 2. 定价页面布局测试

#### 测试 2.1: 卡片等高
- [ ] 访问 http://localhost:5173/pricing
- [ ] 观察所有套餐卡片
- [ ] ✅ 所有卡片高度应该一致

#### 测试 2.2: 按钮对齐
- [ ] 观察购买按钮位置
- [ ] ✅ 所有购买按钮应该在卡片底部对齐

#### 测试 2.3: 响应式布局
- [ ] 调整浏览器窗口宽度
- [ ] 测试桌面端（>1200px）
- [ ] 测试平板端（768px-1200px）
- [ ] 测试移动端（<768px）
- [ ] ✅ 布局应该正确适配各种屏幕尺寸

---

### 3. 支付流程测试

#### 测试 3.1: 创建订单
- [ ] 登录账号
- [ ] 访问定价页面
- [ ] 点击"立即购买"
- [ ] ✅ 应该成功创建订单

#### 测试 3.2: 跳转支付宝
- [ ] 创建订单后
- [ ] ✅ 应该自动跳转到支付宝支付页面

#### 测试 3.3: 支付回调
- [ ] 完成支付（或模拟支付）
- [ ] ✅ 应该跳转回应用
- [ ] ✅ 会员状态应该更新

---

### 4. 用户中心测试

#### 测试 4.1: 查看会员信息
- [ ] 登录账号
- [ ] 访问用户中心
- [ ] ✅ 应该显示当前会员类型
- [ ] ✅ 应该显示到期时间
- [ ] ✅ 应该显示剩余次数

#### 测试 4.2: 查看订单历史
- [ ] 访问订单历史页面
- [ ] ✅ 应该显示所有订单
- [ ] ✅ 订单状态应该正确

#### 测试 4.3: 查看使用记录
- [ ] 访问使用记录页面
- [ ] ✅ 应该显示生成和导出记录

---

### 5. 核心功能测试

#### 测试 5.1: 生成攻略
- [ ] 上传图片
- [ ] 填写账号信息
- [ ] 点击生成
- [ ] ✅ 应该成功生成攻略
- [ ] ✅ 使用次数应该减少

#### 测试 5.2: 导出攻略
- [ ] 生成攻略后
- [ ] 点击导出
- [ ] ✅ 应该成功导出 HTML
- [ ] ✅ 导出次数应该减少

#### 测试 5.3: 权限控制
- [ ] 使用免费账号
- [ ] 尝试超过每日限制
- [ ] ✅ 应该提示升级会员

---

## 🐛 常见问题排查

### 问题 1: 刷新后丢失登录状态

**检查**:
```bash
# 1. 打开浏览器开发者工具
# 2. 查看 Application > Local Storage
# 3. 应该有 key: xiaohongshu-auth
```

**解决**:
- 确认 `src/lib/supabase.ts` 中 `persistSession: true`
- 确认 `src/main.ts` 中调用了 `userStore.init()`

### 问题 2: 定价页面卡片高度不一致

**检查**:
```bash
# 1. 打开浏览器开发者工具
# 2. 检查 .pricing-card 样式
# 3. 应该有 display: flex, flex-direction: column, min-height: 500px
```

**解决**:
- 确认 `src/views/PricingView.vue` 中的 CSS 样式正确

### 问题 3: 支付跳转失败

**检查**:
```bash
# 1. 查看浏览器控制台错误
# 2. 查看后端日志
# 3. 确认支付宝配置正确
```

**解决**:
- 检查 `backend/.env` 中的支付宝配置
- 确认 Supabase 数据库中有套餐配置
- 运行 `./diagnose-payment-error.sh` 诊断

---

## 📊 测试结果记录

### 认证功能
- [ ] 刷新页面保持登录
- [ ] 关闭浏览器后恢复
- [ ] 跨标签页同步
- [ ] Token 自动刷新

### 定价页面
- [ ] 卡片等高
- [ ] 按钮对齐
- [ ] 响应式布局

### 支付流程
- [ ] 创建订单
- [ ] 跳转支付宝
- [ ] 支付回调

### 用户中心
- [ ] 会员信息
- [ ] 订单历史
- [ ] 使用记录

### 核心功能
- [ ] 生成攻略
- [ ] 导出攻略
- [ ] 权限控制

---

## 🎉 测试完成

如果所有测试都通过，恭喜你！应用已经可以正常使用了。

如果有测试失败，请查看上面的"常见问题排查"部分，或者联系开发者。

---

## 📝 测试报告模板

```
测试日期: ____________________
测试人员: ____________________

认证功能: ✅ / ❌
定价页面: ✅ / ❌
支付流程: ✅ / ❌
用户中心: ✅ / ❌
核心功能: ✅ / ❌

问题记录:
1. ________________________________
2. ________________________________
3. ________________________________

备注:
________________________________
________________________________
```
